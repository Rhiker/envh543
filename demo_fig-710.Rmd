---
title: "R Mardown Demo for ENV H 543"
author: "Brian High"
date: "3/10/2016"
output: html_document
---

## This is a demo of R Markdown

We will be using code from the book:

> [Quantitative microbial risk assessment](http://site.ebrary.com/lib/uwash/detail.action?docID=10880289), 
> Charles N. Haas; Joan B. Rose; Charles P. Gerba.
> 2014 Hoboken, New Jersey : Wiley, p. 251.

This is the copyright statement for the book:

> Â© Haas, Charles N.; Rose, Joan B.; Gerba, Charles P., Jun 02, 2014, 
> Quantitative Microbial Risk Assessment Wiley, Somerset, ISBN: 9781118910528

## Clear the workspace

```{r}
# Clear the workspace, unless you are running in knitr context.
if (!isTRUE(getOption('knitr.in.progress'))) {
    closeAllConnections()
    rm(list = ls())
}
```

## Load packages

Define a function to auto-install and load required packages.

```{r}
# Load one or more packages into memory, installing as needed.
load.pkgs <- function(pkgs, repos = "http://cran.r-project.org") {
    result <- sapply(pkgs, function(pkg) { 
        if (!suppressWarnings(require(pkg, character.only = TRUE))) {
            install.packages(pkg, quiet = TRUE, repos = repos)
            library(pkg, character.only = TRUE)}})
}
```

Use the this function to load the packages we will need.

```{r message=FALSE, warning=FALSE}
# Load packages, installing as needed.
load.pkgs("deSolve")
```

## Create a data folder

This is not needed for this example, but we are showing a nice way to do this.

```{r}
# Create the data folder if it does not already exist.
data.dir <- "data"
dir.create(file.path(data.dir),
           showWarnings = FALSE,
           recursive = TRUE)
```


## Compute generalized logistic growth

We will use code from:

> Figure 7.10 R code to compute generalized logistic growth equation.

... to generate a plot.

### Create a function: `genlogist()`

Generalized logistic with zero, one, two and three parameters (other than k and K).

```{r}
genlogist <- function(t, N, params) {
    k <- params[1]
    K <- params[2]
    theta1 <- 1
    theta2 <- 1
    theta3 <- 1
    model <- params[6]
    if (model > 0)
        theta1 <- params[3]
    if (model > 1)
        theta2 <- params[4]
    if (model > 2)
        theta3 <- params[5]
    dydt <- k * (N ^ theta2) * (1 - (N / K) ^ theta1) ^ theta3 
    list(dydt)
}
```

### Configure the parameters

```{r}
model <- 3
10 -> k  # lower-case "k"
1e6 -> K  # capital "K"
.7 -> theta1
.3 -> theta2
.5 -> theta3
params <- c(k, K, theta1, theta2, theta3, model)
N0 <- 1e1 
times <- seq(0, 8, by = 0.1)
```

### Run the model

```{r}
y <- ode(N0, times, func = genlogist, parms = params, method = 'adams')
```

### Show the plot

```{r}
plot(y, log = "y") 
```

### Print the results

```{r}
print(y)
```